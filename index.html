<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce System Scaling Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .service-box {
            transition: all 0.3s ease-in-out;
            z-index: 10;
            position: relative;
        }
        .instance {
            transition: all 0.3s ease-in-out;
            width: 1rem;
            height: 1rem;
        }
        .instance.busy {
            background-color: #f59e0b; /* amber-500 */
        }
        .instance.idle {
            background-color: #22c55e; /* green-500 */
        }
        .instance.scaling-up {
            animation: scale-up 0.5s ease-out;
        }
        .instance.scaling-down {
            animation: scale-down 0.5s ease-out;
        }
        @keyframes scale-up {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes scale-down {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0); opacity: 0; }
        }
        .log-entry {
            animation: fade-in 0.5s ease-out;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .flow-line {
            stroke: #4b5563; /* gray-600 */
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="container mx-auto p-4 max-w-7xl">
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-white">Digital Factory Scaling Simulation</h1>
            <p class="text-gray-400 mt-1">Based on the report "Optimising software architecture using Operational Management".</p>
        </header>

        <!-- Controls and Global Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                <h2 class="text-lg font-semibold text-gray-300 mb-2">Controls</h2>
                <div class="flex space-x-2">
                    <button id="startBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">Start</button>
                    <button id="stopBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded w-full" disabled>Stop</button>
                </div>
                 <div class="flex space-x-2 mt-2">
                    <button id="typicalDayBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded w-full">Typical Day</button>
                    <button id="flashSaleBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded w-full">Flash Sale</button>
                </div>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg text-center">
                <h2 class="text-lg font-semibold text-gray-300">Simulation Time</h2>
                <p id="simTime" class="text-3xl font-bold text-white">00:00:00</p>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg text-center">
                <h2 class="text-lg font-semibold text-gray-300">Total Hourly Cost</h2>
                <p id="totalCost" class="text-3xl font-bold text-green-400">$0.00</p>
            </div>
             <div class="bg-gray-800 p-4 rounded-lg shadow-lg text-center">
                <h2 class="text-lg font-semibold text-gray-300">Incoming RPS</h2>
                <p id="incomingRPS" class="text-3xl font-bold text-cyan-400">0</p>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg lg:col-span-1">
                <h3 class="text-lg font-semibold text-gray-300 mb-2">Incoming Requests (RPS)</h3>
                <canvas id="rpsChart"></canvas>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg lg:col-span-1">
                 <h3 class="text-lg font-semibold text-gray-300 mb-2">P95 Checkout Lead Time (ms)</h3>
                <canvas id="latencyChart"></canvas>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg lg:col-span-1">
                <h3 class="text-lg font-semibold text-gray-300 mb-2">Total Infrastructure Cost ($/hr)</h3>
                <canvas id="costChart"></canvas>
            </div>
        </div>

        <!-- Microservices Visualization -->
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-white mb-4">Microservice Workstations</h2>
            <div class="relative">
                <!-- SVG Lines for Flow Diagram -->
                <svg class="absolute w-full h-full" style="z-index: 1;">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#4b5563" />
                        </marker>
                    </defs>
                    <!-- API Gateway to User Auth -->
                    <path d="M 50% 0 V 8%" class="flow-line"></path>
                    <!-- User Auth to Product Catalog -->
                    <path d="M 29% 12.5% H 71%" class="flow-line"></path>
                    <!-- Product Catalog to Shopping Cart -->
                    <path d="M 71% 17% C 71% 25%, 29% 25%, 29% 33%" class="flow-line"></path>
                    <!-- Shopping Cart to Inventory -->
                    <path d="M 29% 37.5% H 71%" class="flow-line"></path>
                    <!-- Shopping Cart to Checkout -->
                    <path d="M 21% 42% C 21% 50%, 42% 50%, 42% 58%" class="flow-line"></path>
                    <!-- Inventory to Checkout -->
                    <path d="M 79% 42% C 79% 50%, 58% 50%, 58% 58%" class="flow-line"></path>
                    <!-- Checkout to Payment -->
                    <path d="M 50% 67% V 70% C 50% 75%, 37% 75%, 37% 83%" class="flow-line"></path>
                    <!-- Checkout to Order -->
                    <path d="M 50% 67% V 70% C 50% 75%, 63% 75%, 63% 83%" class="flow-line"></path>
                </svg>

                <!-- Service Grid -->
                <div class="relative grid grid-cols-12 gap-y-12" style="z-index: 2;">
                    <!-- Row 1 -->
                    <div class="col-start-4 col-span-6 text-center">
                        <div class="inline-block bg-pink-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg">API Gateway (Request Source)</div>
                    </div>
                    <div id="service-placeholder-UserAuthentication" class="col-start-2 col-span-3"></div>
                    <div class="col-span-4"></div> <!-- Spacer -->
                    <div id="service-placeholder-ProductCatalog" class="col-start-8 col-span-3"></div>
                    
                    <!-- Row 2 -->
                    <div id="service-placeholder-ShoppingCart" class="col-start-2 col-span-3"></div>
                    <div class="col-span-4"></div> <!-- Spacer -->
                    <div id="service-placeholder-Inventory" class="col-start-8 col-span-3"></div>

                    <!-- Row 3 -->
                    <div id="service-placeholder-Checkout" class="col-start-5 col-span-4"></div>

                    <!-- Row 4 -->
                    <div id="service-placeholder-Payment" class="col-start-3 col-span-3"></div>
                    <div class="col-span-4"></div> <!-- Spacer -->
                    <div id="service-placeholder-Order" class="col-start-7 col-span-3"></div>
                </div>
            </div>
        </div>
        
        <!-- Event Log -->
        <div>
            <h2 class="text-2xl font-bold text-white mb-4">Event Log</h2>
            <div id="logContainer" class="bg-gray-800 p-4 rounded-lg shadow-lg h-64 overflow-y-auto font-mono text-sm">
                <!-- Log entries will be injected here -->
            </div>
        </div>

    </div>

    <script>
        // --- CONFIGURATION & SETUP ---
        const SERVICE_DEFINITIONS = {
            'UserAuthentication': { name: 'User Auth', s: 20, cv_s: 1.2, cost: 0.090, scaleOutUtil: 0.80, scaleInUtil: 0.40, p95Slo: 50, emergencySlo: 75 },
            'ProductCatalog': { name: 'Product Catalog', s: 15, cv_s: 1.5, cost: 0.090, scaleOutUtil: 0.85, scaleInUtil: 0.30, p95Slo: 40, emergencySlo: 60 },
            'Inventory': { name: 'Inventory', s: 50, cv_s: 2.0, cost: 0.180, scaleOutUtil: 0.75, scaleInUtil: 0.40, p95Slo: 150, emergencySlo: 200 },
            'ShoppingCart': { name: 'Shopping Cart', s: 30, cv_s: 1.8, cost: 0.180, scaleOutUtil: 0.80, scaleInUtil: 0.40, p95Slo: 100, emergencySlo: 150 },
            'Checkout': { name: 'Checkout', s: 100, cv_s: 2.5, cost: 0.361, scaleOutUtil: 0.70, scaleInUtil: 0.50, p95Slo: 250, emergencySlo: 350 },
            'Payment': { name: 'Payment', s: 250, cv_s: 3.0, cost: 0.090, scaleOutUtil: 0.70, scaleInUtil: 0.50, p95Slo: 400, emergencySlo: 500 },
            'Order': { name: 'Order', s: 80, cv_s: 2.2, cost: 0.180, scaleOutUtil: 0.75, scaleInUtil: 0.40, p95Slo: 200, emergencySlo: 300 },
        };

        const REQUEST_ROUTING = {
            'Search': ['UserAuthentication', 'ProductCatalog'],
            'ViewProduct': ['UserAuthentication', 'ProductCatalog'],
            'AddToCart': ['UserAuthentication', 'ProductCatalog', 'ShoppingCart'],
            'ViewCart': ['UserAuthentication', 'ProductCatalog', 'ShoppingCart'],
            'StartCheckout': ['UserAuthentication', 'ProductCatalog', 'ShoppingCart', 'Inventory', 'Checkout'],
            'ProcessPayment': ['UserAuthentication', 'ShoppingCart', 'Inventory', 'Checkout', 'Payment'],
            'CreateOrder': ['UserAuthentication', 'ShoppingCart', 'Inventory', 'Checkout', 'Order'],
        };
        
        let simulationInterval;
        let simTimeSeconds = 0;
        let services = {};
        let globalRequestId = 0;
        let completedCheckoutRequests = [];
        let currentScenario = () => 0;

        const TICKS_PER_SECOND = 5;
        const SUSTAINED_PERIOD_SECONDS = { out: 60, in: 180, emergency: 10 };
        const ROLLING_WINDOW_SIZE = 100;

        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const typicalDayBtn = document.getElementById('typicalDayBtn');
        const flashSaleBtn = document.getElementById('flashSaleBtn');
        const simTimeEl = document.getElementById('simTime');
        const totalCostEl = document.getElementById('totalCost');
        const incomingRPSEl = document.getElementById('incomingRPS');
        const logContainer = document.getElementById('logContainer');
        
        let charts = {};
        function createChart(ctx, label, color) {
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: label,
                        data: [],
                        borderColor: color,
                        backgroundColor: `${color}33`,
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4,
                        fill: true,
                    }]
                },
                options: {
                    scales: {
                        x: { ticks: { display: false }, grid: { color: '#4b5563' } },
                        y: { beginAtZero: true, grid: { color: '#4b5563' }, ticks: { color: '#d1d5db'} }
                    },
                    plugins: { legend: { display: false } },
                    animation: { duration: 200 }
                }
            });
        }

        function initializeCharts() {
            charts.rps = createChart(document.getElementById('rpsChart').getContext('2d'), 'Incoming RPS', '#22d3ee');
            charts.latency = createChart(document.getElementById('latencyChart').getContext('2d'), 'P95 Checkout Latency (ms)', '#f472b6');
            charts.cost = createChart(document.getElementById('costChart').getContext('2d'), 'Total Cost ($/hr)', '#4ade80');
        }

        class Microservice {
            constructor(id, def) {
                this.id = id;
                this.def = def;
                this.instances = 1;
                this.queue = [];
                this.processing = [];
                this.completedWindow = [];
                this.utilization = 0;
                this.p95 = 0;
                this.utilOutTimer = 0;
                this.utilInTimer = 0;
                this.emergencyTimer = 0;
                this.createElement();
            }

            createElement() {
                const placeholder = document.getElementById(`service-placeholder-${this.id}`);
                if (!placeholder) return;

                const box = document.createElement('div');
                box.id = `service-${this.id}`;
                box.className = 'service-box bg-gray-800 p-4 rounded-lg shadow-lg h-full flex flex-col justify-between';
                box.innerHTML = `
                    <div>
                        <h3 class="font-bold text-lg text-white">${this.def.name}</h3>
                        <div class="mt-2 space-y-2 text-sm">
                            <div class="flex justify-between"><span>Instances:</span> <span id="inst-${this.id}" class="font-semibold text-cyan-400">1</span></div>
                            <div class="flex justify-between"><span>Queue:</span> <span id="q-${this.id}" class="font-semibold text-yellow-400">0</span></div>
                            <div class="flex justify-between"><span>Utilization:</span> <span id="util-${this.id}" class="font-semibold text-purple-400">0%</span></div>
                            <div class="flex justify-between"><span>P95 (ms):</span> <span id="p95-${this.id}" class="font-semibold text-pink-400">0</span></div>
                        </div>
                    </div>
                    <div id="viz-${this.id}" class="mt-3 flex flex-wrap gap-1"></div>
                `;
                placeholder.appendChild(box);
                this.updateInstanceViz();
            }

            enqueue(request) { this.queue.push(request); }

            tick() {
                this.processing = this.processing.filter(p => {
                    p.timeLeft -= 1000 / TICKS_PER_SECOND;
                    if (p.timeLeft <= 0) {
                        this.onRequestComplete(p.request);
                        return false;
                    }
                    return true;
                });

                while (this.processing.length < this.instances && this.queue.length > 0) {
                    const request = this.queue.shift();
                    request.timeEnteredService = simTimeSeconds;
                    const serviceTime = this.def.s * (1 + (Math.random() - 0.5) * this.def.cv_s * 2);
                    this.processing.push({ request, timeLeft: Math.max(1, serviceTime) });
                }

                this.utilization = this.instances > 0 ? this.processing.length / this.instances : 0;
                this.calculateP95();
                this.checkScaling();
            }

            onRequestComplete(request) {
                const timeInService = (simTimeSeconds - request.timeEnteredService) * 1000;
                this.completedWindow.push(timeInService);
                if (this.completedWindow.length > ROLLING_WINDOW_SIZE) this.completedWindow.shift();

                request.path.shift();
                if (request.path.length > 0) {
                    services[request.path[0]].enqueue(request);
                } else if (request.type === 'StartCheckout') {
                    const totalTime = (simTimeSeconds - request.startTime) * 1000;
                    completedCheckoutRequests.push(totalTime);
                    if (completedCheckoutRequests.length > ROLLING_WINDOW_SIZE) completedCheckoutRequests.shift();
                }
            }

            calculateP95() {
                if (this.completedWindow.length < 10) { this.p95 = 0; return; }
                const sorted = [...this.completedWindow].sort((a, b) => a - b);
                this.p95 = sorted[Math.floor(sorted.length * 0.95) - 1];
            }

            checkScaling() {
                if (this.p95 > this.def.emergencySlo) {
                    this.emergencyTimer += 1;
                    if (this.emergencyTimer >= SUSTAINED_PERIOD_SECONDS.emergency * TICKS_PER_SECOND) {
                        this.scaleOut('P95 SLO Breach');
                        this.emergencyTimer = 0;
                    }
                } else { this.emergencyTimer = 0; }

                if (this.utilization > this.def.scaleOutUtil) {
                    this.utilOutTimer += 1;
                    if (this.utilOutTimer >= SUSTAINED_PERIOD_SECONDS.out * TICKS_PER_SECOND) {
                        this.scaleOut('High Utilization');
                        this.utilOutTimer = 0;
                    }
                } else { this.utilOutTimer = 0; }

                if (this.utilization < this.def.scaleInUtil && this.instances > 1) {
                    this.utilInTimer += 1;
                    if (this.utilInTimer >= SUSTAINED_PERIOD_SECONDS.in * TICKS_PER_SECOND) {
                        this.scaleIn();
                        this.utilInTimer = 0;
                    }
                } else { this.utilInTimer = 0; }
            }

            scaleOut(reason) {
                this.instances++;
                logEvent(`SCALING UP ${this.def.name} to ${this.instances} instances. Reason: ${reason}.`, 'text-green-400');
                this.updateInstanceViz(true);
            }

            scaleIn() {
                if (this.instances <= 1) return;
                this.instances--;
                logEvent(`SCALING DOWN ${this.def.name} to ${this.instances} instances. Reason: Low Utilization.`, 'text-yellow-400');
                this.updateInstanceViz(false, true);
            }

            updateUI() {
                document.getElementById(`inst-${this.id}`).textContent = this.instances;
                document.getElementById(`q-${this.id}`).textContent = this.queue.length;
                document.getElementById(`util-${this.id}`).textContent = `${(this.utilization * 100).toFixed(1)}%`;
                const p95El = document.getElementById(`p95-${this.id}`);
                p95El.textContent = this.p95.toFixed(0);
                p95El.className = `font-semibold ${this.p95 > this.def.emergencySlo ? 'text-red-500 animate-pulse' : 'text-pink-400'}`;

                const vizContainer = document.getElementById(`viz-${this.id}`);
                for(let i = 0; i < this.instances; i++) {
                    const instanceEl = vizContainer.children[i];
                    if (i < this.processing.length) {
                        instanceEl.classList.replace('idle', 'busy');
                    } else {
                        instanceEl.classList.replace('busy', 'idle');
                    }
                }
            }
            
            updateInstanceViz(isScalingUp = false, isScalingDown = false) {
                 const vizContainer = document.getElementById(`viz-${this.id}`);
                 const currentVizCount = vizContainer.children.length;

                if (this.instances > currentVizCount) {
                    for (let i = 0; i < this.instances - currentVizCount; i++) {
                        const instanceEl = document.createElement('div');
                        instanceEl.className = 'instance idle rounded-sm';
                        if(isScalingUp) instanceEl.classList.add('scaling-up');
                        vizContainer.appendChild(instanceEl);
                    }
                } else if (this.instances < currentVizCount) {
                    for (let i = 0; i < currentVizCount - this.instances; i++) {
                         const instanceToRemove = vizContainer.lastElementChild;
                         if (isScalingDown) {
                            instanceToRemove.classList.add('scaling-down');
                            instanceToRemove.addEventListener('animationend', () => instanceToRemove.remove());
                         } else {
                            instanceToRemove.remove();
                         }
                    }
                }
            }
        }

        function initializeServices() {
            document.querySelectorAll('[id^="service-placeholder-"]').forEach(p => p.innerHTML = '');
            services = {};
            for (const [id, def] of Object.entries(SERVICE_DEFINITIONS)) {
                services[id] = new Microservice(id, def);
            }
        }

        function typicalDayScenario(time) {
            const peakRPS = 150;
            const troughRPS = 10;
            const cycleSeconds = 24 * 60 * 2;
            const rps = (peakRPS - troughRPS) / 2 * Math.sin((time / cycleSeconds) * 2 * Math.PI - Math.PI / 2) + (peakRPS + troughRPS) / 2;
            return Math.max(troughRPS, rps);
        }

        function flashSaleScenario(time) {
            const baseRPS = 50;
            const saleStart = 60;
            const saleDuration = 300;
            const saleEnd = saleStart + saleDuration;
            const peakRPS = 1000;

            if (time > saleStart && time < saleEnd) {
                const timeIntoSale = time - saleStart;
                const peakTime = saleDuration / 2;
                return peakRPS - Math.pow(timeIntoSale - peakTime, 2) * (peakRPS - baseRPS) / Math.pow(peakTime, 2);
            }
            return baseRPS;
        }

        function simulationTick() {
            simTimeSeconds += 1 / TICKS_PER_SECOND;
            const rps = currentScenario(simTimeSeconds);
            const requestsToGenerate = rps / TICKS_PER_SECOND;
            for (let i = 0; i < requestsToGenerate; i++) {
                const rand = Math.random();
                let requestType;
                if (rand < 0.7) requestType = 'ViewProduct';
                else if (rand < 0.85) requestType = 'Search';
                else if (rand < 0.95) requestType = 'AddToCart';
                else if (rand < 0.98) requestType = 'StartCheckout';
                else requestType = 'CreateOrder';
                
                const path = [...REQUEST_ROUTING[requestType]];
                if (path.length > 0) {
                    services[path[0]].enqueue({
                        id: globalRequestId++, type: requestType, path: path,
                        startTime: simTimeSeconds, timeEnteredService: simTimeSeconds
                    });
                }
            }
            
            Object.values(services).forEach(service => service.tick());
            updateUI(rps);
        }
        
        function getP95CheckoutLatency() {
            if (completedCheckoutRequests.length < 10) return 0;
            const sorted = [...completedCheckoutRequests].sort((a,b) => a-b);
            return sorted[Math.floor(sorted.length * 0.95) - 1];
        }

        function updateUI(rps) {
            const hours = Math.floor(simTimeSeconds / 3600);
            const minutes = Math.floor((simTimeSeconds % 3600) / 60);
            const seconds = Math.floor(simTimeSeconds % 60);
            const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            simTimeEl.textContent = timeString;
            
            const totalCost = Object.values(services).reduce((acc, s) => acc + (s.instances * s.def.cost), 0);
            totalCostEl.textContent = `$${totalCost.toFixed(2)}`;
            incomingRPSEl.textContent = Math.round(rps);

            Object.values(services).forEach(service => service.updateUI());
            
            if (simTimeSeconds % 1 < 1 / TICKS_PER_SECOND) {
                const p95Checkout = getP95CheckoutLatency();
                Object.values(charts).forEach(chart => {
                    chart.data.labels.push(timeString);
                    if (chart.data.labels.length > 100) chart.data.labels.shift();
                });
                charts.rps.data.datasets[0].data.push(rps);
                charts.latency.data.datasets[0].data.push(p95Checkout);
                charts.cost.data.datasets[0].data.push(totalCost);
                Object.values(charts).forEach(chart => {
                    if (chart.data.datasets[0].data.length > 100) chart.data.datasets[0].data.shift();
                    chart.update();
                });
            }
        }

        function logEvent(message, colorClass = 'text-gray-300') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${colorClass}`;
            entry.innerHTML = `<span class="text-gray-500">${simTimeEl.textContent} |</span> ${message}`;
            logContainer.prepend(entry);
            if (logContainer.children.length > 50) logContainer.lastChild.remove();
        }

        function startSimulation() {
            if (simulationInterval) return;
            startBtn.disabled = true;
            stopBtn.disabled = false;
            simulationInterval = setInterval(simulationTick, 1000 / TICKS_PER_SECOND);
            logEvent('Simulation started.', 'text-blue-400');
        }

        function stopSimulation() {
            clearInterval(simulationInterval);
            simulationInterval = null;
            startBtn.disabled = false;
            stopBtn.disabled = true;
            logEvent('Simulation stopped.', 'text-red-400');
        }

        function resetSimulation() {
            stopSimulation();
            simTimeSeconds = 0;
            globalRequestId = 0;
            completedCheckoutRequests = [];
            initializeServices();
            Object.values(charts).forEach(chart => {
                chart.data.labels = [];
                chart.data.datasets[0].data = [];
                chart.update();
            });
            logContainer.innerHTML = '';
            updateUI(0);
        }

        startBtn.addEventListener('click', startSimulation);
        stopBtn.addEventListener('click', stopSimulation);

        typicalDayBtn.addEventListener('click', () => {
            resetSimulation();
            currentScenario = typicalDayScenario;
            logEvent('Scenario set to: Typical Day. Press Start.', 'text-green-400');
        });

        flashSaleBtn.addEventListener('click', () => {
            resetSimulation();
            currentScenario = flashSaleScenario;
            logEvent('Scenario set to: Flash Sale. Press Start.', 'text-purple-400');
        });

        window.onload = () => {
            initializeCharts();
            initializeServices();
            currentScenario = typicalDayScenario;
            updateUI(0);
            logEvent('Simulation ready. Select a scenario and press Start.');
        };
    </script>
</body>
</html>
